+ [author](https://github.com/3293172751)

# 第27节 操作系统接口

+ [回到目录](../README.md)
+ [回到项目首页](../../README.md)
+ [上一节](26.md)
> ❤️💕💕真正动手时间操作系统,从应用软件出发"进入操作系统",成为掌握计算机关键技术的工程师。Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

## 操作系统接口

操作系统提供给用户的由两种接口：

- 命令接口：

- - 作业控制语言
  - 键盘命令
  - 图形界面

- 程序接口：

- - 系统功能调用



## 命令接口

**命令接口是普通用户与操作系统的接口。**

- 命令接口类型：

- - 联机用户接口：

  - - 由一组键盘操作命令及命令解释程序组成（通过命令解释程序对用户从键盘输入的命令进行检查命令格式、完成命令的执行）。

  - 图形接口：

  - - 菜单驱动方式、图符驱动方式（使用鼠标或者触摸屏来实现交互）

  - 脱机用户接口：

  - - 由一组作业控制语言（JCL）组成：

    - I/O命令；编译命令；操作命令；条件命令。

    - \* 程序员在提交作业时会书写作业说明书，包括作业基本情况描述（作业名、用户名、编程语言、允许的最长处理时间等）、作业控制描述（各作业步的操作顺序、出错处理等）和作业资源要求描述（要求处理时间、内存大小、外设种类及数量、优先级等）。

      

- 命令接口类型与操作系统类型的关系

- - 批处理系统 —— 作业控制语言
  - 交互式系统（分时操作系统、微机操作系统）—— 键盘命令及图形用户界面

- 

- 实例操作系统提供的用户界面

- - MS-DOS —— 键盘命令、系统功能调用
  - Windows —— 图形用户界面、系统功能调用（键盘命令相对来说使用的比较少）
  - Linux \ UNIX —— 键盘命令、图形用户界面、系统功能调用



## 系统调用

应用程序与OS的接口，在应用程序中使用系统调用。

系统功能调用是用户在程序一级请求操作系统服务的一种手段，它是带有一定功能号的“访管指令”。访管指令是由硬件提供的一条机器指令，但是其功能是由操作系统中的程序完成的，即由软件方法实现的。

- 系统调用流程

![img](http://sm.nsddd.top//typora/v2-64b1be0ad3a24865dd9e507be37e366a_r.jpg?mail:3293172751@qq.com)

在应用程序中需要在显示器上显示一串字符，那么需要使用C语言中的 `printf` 函数，在 `printf`函数中包含了一条访管指令 `0x80`， 这条访问指令其实就是发出一条软中断信号，让 CPU 执行 `int 0x80` 的中断处理程序。这条中断处理程序对应的就是内核中的 `system_call` 。按照我们之前讲解的中断处理程序的执行过程执行 `0x80` 的中断处理程序。

- 系统调用处理程序： system_call()

- - 系统调用处理程序 system_call() 执行 int 0x80 异常的处理程序，是所有程序调用的入口点。其所完成的主要工作是：

  - - 宏SAVE_ALL保护现场；
    - 正确性检查 ；
    - 依eax中所包含的系统调用号，调用其对应的服务例程：

```text
call *SYMBOL_NAME(sys_call_table)(0,%eax,4) // eax 存放的是系统调用号
```

- - - 系统服务例程结束时，通过宏RESTORE_ALL恢复寄存器；
    - 最后通过`iret`指令返回。

  - 

- 系统调用号

- - linux中，每个系统调用被赋予一个唯一的系统调用号
  - 系统调用号定义在`include/asm-i386/unistd.h`头文件中
  - 系统调用号格式如下：

```bash
       #define  __NR_restart_syscall         0
       #define  __NR_exit		     1
       #define  __NR_fork	             2
       #define  __NR_read	             3
       #define  __NR_write	             4
       #define  __NR_open	             5
       …………
       #define  __NR_fremovexattr           237
```

- 系统调用入口表

- - 系统调用表记录了内核中所有已注册过的系统调用，它是系统调用的跳转表。
  - 系统调用表是一个函数指针数组，表中依次保存所有系统调用的函数指针。
  - Linux系统调用表保存在`arch/i386/kernel/`下的`entry.S`中。

<img src="http://sm.nsddd.top//typora/v2-6e0d2f339c6bd233082cfdfac02124d2_r.jpg?mail:3293172751@qq.com" alt="img" style="zoom:50%;" />

- 系统调用参数传递

- - 寄存器传递

  - - eax：系统调用号
    - ebx, ecx, edx, esi和edi按照顺序存放前五个参数

- 系统调用执行流程

<img src="http://sm.nsddd.top//typora/v2-f60a3edc9a58e90acb9649d08981665e_r.jpg?mail:3293172751@qq.com" alt="img" style="zoom:50%;" />



## END 链接

+ [回到目录](../README.md)
+ [上一节](26.md)
+ [下一节](28.md)
---
+ [参与贡献❤️💕💕](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)